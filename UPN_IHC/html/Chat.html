<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>AgroLink Chat</title>
  <script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Work+Sans:wght@400;500;700;900&display=swap" rel="stylesheet" />
  <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined" rel="stylesheet" />
  <style>
    .material-symbols-outlined {
      font-variation-settings: 'FILL' 0, 'wght' 400, 'GRAD' 0, 'opsz' 24;
    }
    .message-bubble {
      transition: all 0.2s ease;
      max-width: 80%;
    }
    .message-bubble:hover {
      transform: translateY(-1px);
      box-shadow: 0 2px 6px rgba(0,0,0,0.1);
    }
    .dark .message-bubble:hover {
      box-shadow: 0 2px 6px rgba(0,0,0,0.3);
    }
    .status-badge {
      padding: 0.25rem 0.5rem;
      border-radius: 1rem;
      font-size: 0.75rem;
      font-weight: 500;
    }
    .status-en-camino { background-color: #e3f2fd; color: #1976d2; }
    .status-retrasado { background-color: #fff3e0; color: #fb8c00; }
    .status-llego { background-color: #e8f5e9; color: #388e3c; }
    .status-cancelado { background-color: #ffcdd2; color: #d32f2f; }
  </style>
</head>
<body class="bg-background-light dark:bg-background-dark font-display text-text-primary-light dark:text-text-primary-dark">
  <div class="flex h-screen flex-col">
    <header class="flex items-center justify-between border-b border-border-light dark:border-border-dark px-6 py-3 shrink-0">
      <div class="flex items-center gap-3">
        <div class="w-8 h-8 text-primary">
          <svg fill="none" viewBox="0 0 48 48" xmlns="http://www.w3.org/2000/svg">
            <path clip-rule="evenodd" d="M47.2426 24L24 47.2426L0.757355 24L24 0.757355L47.2426 24ZM12.2426 21H35.7574L24 9.24264L12.2426 21Z" fill="currentColor" fill-rule="evenodd"></path>
          </svg>
        </div>
        <h1 class="text-xl font-bold">AgroLink</h1>
      </div>
      <div class="flex items-center gap-4">
        <button class="p-2 rounded-full hover:bg-primary/10 dark:hover:bg-primary/20 transition-colors">
          <span class="material-symbols-outlined text-text-secondary-light dark:text-text-secondary-dark">notifications</span>
        </button>
        <div class="w-10 h-10 rounded-full bg-cover bg-center" style='background-image: url("https://lh3.googleusercontent.com/aida-public/AB6AXuCFgZC7GhvWpeF2M1v9tVM6V6tKD7Px2ALwxdHGz47BD-IR7DtsibR6r1GhhP5bA9Lbh-dcdXsWXAGm9Pgh98Eg6-EU6vRtvjELNhFFAKk8G-fTYIN1loelfwwHVTIdD5O-JPxVM9a9rqRwBGL8ryLfEJnOxNpCp8zSbBaGh7CErgt2qPAalkycfZtEA1ekmO4kZv6bRiBG9amQv6qHC4aCafPa5DZpFrMAAIwWHLS6gGxXB0fxoYGlF2VKTDI_I3iIldDQD03W_A");'></div>
      </div>
    </header>

    <div class="flex flex-1 overflow-hidden">
      <main class="flex-1 flex flex-col">
        <div class="border-b border-border-light dark:border-border-dark p-4">
          <h2 class="text-2xl font-bold">Chat: MaÃ­z a Rosario</h2>
          <div class="flex items-center gap-4 mt-2 text-sm">
            <p><span class="font-semibold">Transportista:</span> Juan PÃ©rez</p>
            <div class="flex items-center gap-1.5">
              <span class="w-2.5 h-2.5 rounded-full bg-green-500"></span>
              <span class="status-badge status-en-camino">En camino</span>
            </div>
          </div>
        </div>

        <div id="chat-messages" class="flex-1 overflow-y-auto p-6 space-y-6"></div>

        <div class="p-4 border-t border-border-light dark:border-border-dark mt-auto">
          <div class="relative">
            <input
              id="message-input"
              class="w-full bg-surface-light dark:bg-surface-dark border border-border-light dark:border-border-dark rounded-lg py-3 pl-4 pr-28 focus:ring-2 focus:ring-primary focus:border-transparent outline-none transition-all"
              placeholder="Escribe un mensaje..."
              type="text"
              maxlength="200"
            />
            <button
              id="send-button"
              class="absolute right-3 top-1/2 -translate-y-1/2 bg-primary text-white dark:text-background-dark font-semibold px-5 py-2 rounded-lg hover:bg-primary/90 transition-colors"
            >
              Enviar
            </button>
          </div>
        </div>
      </main>

      <aside class="w-96 border-l border-border-light dark:border-border-dark flex-col hidden lg:flex">
        <div class="p-6 border-b border-border-light dark:border-border-dark">
          <h3 class="text-lg font-bold">Detalles del EnvÃ­o</h3>
        </div>
        <div class="p-6 space-y-4 flex-1 overflow-y-auto">
          <div class="grid grid-cols-3 gap-4 text-sm">
            <span class="text-text-secondary-light dark:text-text-secondary-dark col-span-1">Producto</span>
            <span class="col-span-2 font-medium">MaÃ­z</span>
          </div>
          <div class="grid grid-cols-3 gap-4 text-sm">
            <span class="text-text-secondary-light dark:text-text-secondary-dark col-span-1">Cantidad</span>
            <span class="col-span-2 font-medium">10 toneladas</span>
          </div>
          <div class="grid grid-cols-3 gap-4 text-sm">
            <span class="text-text-secondary-light dark:text-text-secondary-dark col-span-1">Origen</span>
            <span class="col-span-2 font-medium">Finca La Esperanza, CÃ³rdoba</span>
          </div>
          <div class="grid grid-cols-3 gap-4 text-sm">
            <span class="text-text-secondary-light dark:text-text-secondary-dark col-span-1">Destino</span>
            <span class="col-span-2 font-medium">AlmacÃ©n Central, Rosario</span>
          </div>
          <div class="grid grid-cols-3 gap-4 text-sm">
            <span class="text-text-secondary-light dark:text-text-secondary-dark col-span-1">Estado</span>
            <span class="col-span-2 font-medium status-badge status-en-camino">En camino</span>
          </div>
          <div class="grid grid-cols-3 gap-4 text-sm">
            <span class="text-text-secondary-light dark:text-text-secondary-dark col-span-1">Tiempo estimado</span>
            <span class="col-span-2 font-medium">2 horas</span>
          </div>
          <div class="grid grid-cols-3 gap-4 text-sm">
            <span class="text-text-secondary-light dark:text-text-secondary-dark col-span-1">Patente</span>
            <span class="col-span-2 font-medium">ABC 123</span>
          </div>
          <div class="grid grid-cols-3 gap-4 text-sm">
            <span class="text-text-secondary-light dark:text-text-secondary-dark col-span-1">Remito</span>
            <span class="col-span-2 font-medium">#RM-78945</span>
          </div>
          <div class="grid grid-cols-3 gap-4 text-sm">
            <span class="text-text-secondary-light dark:text-text-secondary-dark col-span-1">Seguro</span>
            <span class="col-span-2 font-medium">Activo</span>
          </div>
          <div class="grid grid-cols-3 gap-4 text-sm">
            <span class="text-text-secondary-light dark:text-text-secondary-dark col-span-1">Temperatura</span>
            <span class="col-span-2 font-medium">22Â°C</span>
          </div>
          <div class="grid grid-cols-3 gap-4 text-sm">
            <span class="text-text-secondary-light dark:text-text-secondary-dark col-span-1">Humedad</span>
            <span class="col-span-2 font-medium">45%</span>
          </div>
          <div class="grid grid-cols-3 gap-4 text-sm">
            <span class="text-text-secondary-light dark:text-text-secondary-dark col-span-1">Responsable</span>
            <span class="col-span-2 font-medium">Carlos GÃ³mez</span>
          </div>
          <div class="grid grid-cols-3 gap-4 text-sm">
            <span class="text-text-secondary-light dark:text-text-secondary-dark col-span-1">Contacto</span>
            <span class="col-span-2 font-medium">+54 9 351 987 6543</span>
          </div>
          <div class="grid grid-cols-3 gap-4 text-sm">
            <span class="text-text-secondary-light dark:text-text-secondary-dark col-span-1">Notas</span>
            <span class="col-span-2 font-medium">Entrega en muelle 3</span>
          </div>
        </div>
        <div class="p-6 border-t border-border-light dark:border-border-dark">
          <h3 class="text-lg font-bold mb-4">Contacto del Transportista</h3>
          <div class="flex items-center gap-4">
            <img
              alt="Juan PÃ©rez avatar"
              class="w-14 h-14 rounded-full"
              src="https://lh3.googleusercontent.com/aida-public/AB6AXuB6rOMmm5MhtlzbNsGtCS1yv2ic144q0DuUxW9qXmWo2RadV4ABrq50iiPyF0yolPxDSCe0hM8UC7DUAnTDPsrMjqG3xhh6hRNgO8Bcse4WZDvt11zX4M_p0Y1roMqJ7U-QHQaU8Npy7Og_B-wUo7-JQ3ThX4E8oy2Jz6p2n5l_9UnHCxqpOsy8mZ4buZri5nyHNF33B-e5gv47mqQvm9DvthW8SJvEMUMHkMEoKy8WBrhqIJpGxkpl7DlFmC5rYhssWP7__swwFw"
            />
            <div>
              <p class="font-semibold">Juan PÃ©rez</p>
              <p class="text-sm text-text-secondary-light dark:text-text-secondary-dark">+54 9 351 123 4567</p>
            </div>
          </div>
        </div>
      </aside>
    </div>
  </div>

  <script>
    const shipment = {
      product: "MaÃ­z",
      quantity: "10 toneladas",
      origin: "Finca La Esperanza, CÃ³rdoba",
      destination: "AlmacÃ©n Central, Rosario",
      driver: "Juan PÃ©rez",
      status: "En camino",
      estimatedTime: "2 horas",
      currentLocation: "CÃ³rdoba",
      destinationLocation: "Rosario",
      plate: "ABC 123",
      remito: "#RM-78945",
      insurance: "Activo",
      temperature: "22Â°C",
      humidity: "45%",
      responsible: "Carlos GÃ³mez",
      contact: "+54 9 351 987 6543",
      notes: "Entrega en muelle 3"
    };

    const responsesDB = {
      greeting: [
        "Â¡Hola! Soy tu asistente de AgroLink. Â¿Necesitas ayuda con este envÃ­o?",
        "Hola, Carlos. Estoy aquÃ­ para ayudarte con el envÃ­o de maÃ­z a Rosario.",
        "Â¿En quÃ© puedo ayudarte hoy? Juan estÃ¡ en camino.",
        "Â¡Bienvenido al chat de AgroLink! Â¿CÃ³mo puedo asistirte?",
        "Hola, Â¿todo bien con el envÃ­o?",
        "Â¿Listo para coordinar la entrega?",
        "Â¡Saludos! Â¿QuÃ© necesitas saber sobre el transporte?",
        "Â¿CÃ³mo va todo? Â¿Necesitas algo del camiÃ³n?",
        "Â¡Hola! Â¿Revisamos el estado del envÃ­o?",
        "Â¿Te gustarÃ­a actualizar algo del envÃ­o?"
      ],
      thanks: [
        "Â¡De nada! Estoy aquÃ­ para ayudarte.",
        "Gracias por escribir. Juan ha sido notificado.",
        "Â¡Perfecto! Te mantendrÃ© al tanto del estado del envÃ­o.",
        "Gracias por tu mensaje. Â¡Estamos para servirte!",
        "Â¡Con gusto! Â¿Algo mÃ¡s en lo que pueda ayudarte?",
        "Me alegra poder ayudarte. Â¿Necesitas otra cosa?",
        "No hay de quÃ©. Â¿Quieres revisar los documentos?",
        "Â¡Siempre a la orden! Â¿Necesitas mÃ¡s informaciÃ³n?",
        "Â¡Gracias a ti! Â¿Deseas que te avise al llegar?",
        "Â¡Claro! Â¿Quieres que coordine con el almacÃ©n?"
      ],
      arrival: [
        "Estoy a unos minutos. Â¿Hay instrucciones especiales para la descarga?",
        "Juan estÃ¡ a 5 km de destino. Â¿Puedes confirmar el punto de entrega?",
        "Â¡Casi llegamos! Por favor, confirma si hay algÃºn acceso restringido.",
        "El transporte estÃ¡ cerca. Â¿Hay alguien esperando en el almacÃ©n?",
        "Estamos a 10 minutos. Â¿El muelle 3 estÃ¡ listo?",
        "Â¿Puedes verificar que el Ã¡rea de descarga estÃ© despejada?",
        "Juan estÃ¡ en las afueras de Rosario. Â¿Confirmas entrega en muelle 3?",
        "Â¿Necesitas que envÃ­e una foto del lugar de descarga?",
        "Â¿Hay horario especÃ­fico para la descarga?",
        "Â¿Debo avisar al supervisor del almacÃ©n?"
      ],
      product: [
        "El envÃ­o actual es de 10 toneladas de maÃ­z desde CÃ³rdoba hasta Rosario.",
        "Producto: MaÃ­z | Cantidad: 10 toneladas | Origen: Finca La Esperanza",
        "Â¿Te gustarÃ­a ver los detalles del producto o el historial de envÃ­os?",
        "Este envÃ­o contiene maÃ­z de primera calidad. Â¿Necesitas informaciÃ³n adicional?",
        "El maÃ­z estÃ¡ certificado como libre de transgÃ©nicos.",
        "Â¿Quieres que te envÃ­e el certificado fitosanitario?",
        "La humedad del maÃ­z estÃ¡ en 12%, ideal para almacenamiento.",
        "Â¿Necesitas el anÃ¡lisis de calidad del lote?",
        "Â¿Deseas recibir el remito digital?",
        "Â¿Te gustarÃ­a programar el prÃ³ximo envÃ­o?"
      ],
      delay: [
        "Hay un ligero retraso debido al trÃ¡fico. Estimado: 3 horas.",
        "El envÃ­o tiene un retraso de 45 minutos. Juan te actualizarÃ¡ en breve.",
        "ActualizaciÃ³n: El envÃ­o se retrasarÃ¡ aproximadamente 1 hora mÃ¡s.",
        "Lo sentimos, hay un contratiempo en la ruta. Estamos trabajando para minimizar el impacto.",
        "Se presentÃ³ un control policial en ruta. Retraso estimado: 30 min.",
        "Hay obras en la Ruta 9. Estamos desviados, pero seguimos en tiempo.",
        "El camiÃ³n tuvo una parada tÃ©cnica. Ya estÃ¡ en movimiento.",
        "Â¿Quieres que active la alerta de retraso para el almacÃ©n?",
        "Â¿Deseas reprogramar la entrega?",
        "Â¿Necesitas que contacte a otro transportista?"
      ],
      arrived: [
        "Â¡El envÃ­o ha llegado! Juan estÃ¡ esperando en el punto de entrega.",
        "Â¡Listo! Juan ha completado la entrega en Rosario.",
        "EnvÃ­o finalizado. Gracias por usar AgroLink.",
        "La carga ha sido entregada exitosamente. Â¿Necesitas algo mÃ¡s?",
        "Juan ya estÃ¡ en el muelle 3. Â¿Confirmas recepciÃ³n?",
        "Â¿Puedes firmar el remito digital?",
        "Â¿Deseas calificar este servicio?",
        "Â¿Necesitas el comprobante de entrega?",
        "Â¿Quieres programar la prÃ³xima carga?",
        "Â¿Todo en orden con la descarga?"
      ],
      default: [
        "Gracias por tu mensaje. Juan ha sido notificado.",
        "Tu mensaje ha sido enviado. Juan te responderÃ¡ pronto.",
        "Â¡Recibido! Juan estÃ¡ en camino y ha visto tu mensaje.",
        "Hemos registrado tu consulta. El transportista serÃ¡ informado inmediatamente.",
        "Tu mensaje fue entregado al conductor.",
        "Â¿Quieres que le pase tu mensaje directamente a Juan?",
        "Â¿Deseas que te llame Juan en los prÃ³ximos minutos?",
        "Â¿Necesitas que active el modo urgente?",
        "Â¿Quieres que te envÃ­e una actualizaciÃ³n cada 15 minutos?",
        "Â¿Prefieres que te contacte por WhatsApp?"
      ],
      help: [
        "Â¿Necesitas ayuda con el seguimiento, documentaciÃ³n o coordinaciÃ³n de entrega?",
        "Puedo ayudarte con cualquier duda sobre el envÃ­o, el transporte o los productos.",
        "Â¿Quieres que te ayude a contactar con Juan o a verificar el estado del envÃ­o?",
        "Estoy aquÃ­ para lo que necesites. Solo dime en quÃ© puedo ayudarte.",
        "Â¿Quieres ver el historial de ubicaciones del camiÃ³n?",
        "Â¿Necesitas el remito, factura o certificado?",
        "Â¿Deseas cambiar el punto de entrega?",
        "Â¿Quieres activar notificaciones en tiempo real?",
        "Â¿Necesitas asistencia con el pago?",
        "Â¿Quieres que te genere un reporte del envÃ­o?"
      ],
      location: [
        "El transporte se encuentra actualmente en CÃ³rdoba, rumbo a Rosario.",
        "Juan estÃ¡ en la Ruta Nacional 9, a 15 km de Rosario.",
        "Â¿Quieres que te comparta la ubicaciÃ³n en tiempo real del camiÃ³n?",
        "La Ãºltima ubicaciÃ³n registrada es en la intersecciÃ³n de Av. Mitre y Ruta 9.",
        "Â¿Deseas ver el mapa con la ruta trazada?",
        "Â¿Quieres que active el GPS en tiempo real?",
        "Â¿Necesitas las coordenadas exactas?",
        "Â¿Quieres que te avise al cruzar cada ciudad?",
        "Â¿Deseas compartir la ubicaciÃ³n con un tercero?",
        "Â¿Quieres que te envÃ­e un enlace de seguimiento?"
      ],
      documentation: [
        "Â¿Necesitas la guÃ­a de remisiÃ³n, factura o certificado de origen?",
        "Puedo enviarte todos los documentos relacionados con este envÃ­o por correo.",
        "Los documentos estÃ¡n listos. Â¿Prefieres recibirlos por email o WhatsApp?",
        "Tienes acceso a todos los documentos desde tu panel de usuario.",
        "Â¿Quieres que te envÃ­e el remito en PDF?",
        "Â¿Necesitas la factura A o B?",
        "Â¿Deseas el certificado de calidad del maÃ­z?",
        "Â¿Quieres que te genere un comprobante de seguro?",
        "Â¿Necesitas el manifiesto de carga?",
        "Â¿Quieres que archive los documentos en la nube?"
      ],
      payment: [
        "Â¿Necesitas informaciÃ³n sobre el pago o facturaciÃ³n del servicio?",
        "El pago se procesarÃ¡ automÃ¡ticamente una vez confirmada la entrega.",
        "Â¿Quieres que te envÃ­e el comprobante de pago o el detalle de costos?",
        "Tenemos varias opciones de pago. Â¿Te gustarÃ­a que te las explique?",
        "Â¿Deseas pagar con tarjeta, transferencia o efectivo?",
        "Â¿Quieres que te envÃ­e el presupuesto detallado?",
        "Â¿Necesitas financiar el pago en cuotas?",
        "Â¿Quieres que te avise antes de cobrar?",
        "Â¿Deseas un descuento por fidelidad?",
        "Â¿Quieres que te genere un reporte de gastos mensuales?"
      ],
      emergency: [
        "Si tienes una emergencia, por favor avÃ­same inmediatamente.",
        "En caso de urgencia, puedes llamar directamente a Juan al +54 9 351 123 4567.",
        "Para situaciones de emergencia, nuestro equipo estÃ¡ disponible las 24 horas.",
        "No dudes en comunicarte si algo sale de lo normal. Estamos aquÃ­ para ayudarte.",
        "Â¿Hubo un accidente? Â¿Necesitas asistencia vial?",
        "Â¿El camiÃ³n tuvo una falla mecÃ¡nica?",
        "Â¿Hay un problema con la carga?",
        "Â¿Necesitas activar el protocolo de emergencia?",
        "Â¿Quieres que envÃ­e un camiÃ³n de respaldo?",
        "Â¿Deseas cancelar o reprogramar el envÃ­o de inmediato?"
      ],
      weather: [
        "El clima en Rosario estÃ¡ despejado. Ideal para la descarga.",
        "Hay lluvia leve en la zona. Â¿Quieres que cubra la carga?",
        "Â¿Necesitas que revise las condiciones climÃ¡ticas en destino?",
        "La temperatura es de 22Â°C, humedad 45%. Perfecto para el maÃ­z.",
        "Â¿Quieres que active el control ambiental del camiÃ³n?",
        "Â¿Deseas que te envÃ­e alertas meteorolÃ³gicas?",
        "Â¿Necesitas que ajuste la ventilaciÃ³n de la carga?",
        "Â¿Quieres que revise el historial climÃ¡tico del trayecto?",
        "Â¿Deseas que active el seguro contra eventos climÃ¡ticos?",
        "Â¿Quieres que te avise si cambian las condiciones?"
      ],
      vehicle: [
        "El camiÃ³n es un Mercedes-Benz Atego 2023, con caja cerrada.",
        "Â¿Quieres ver las fotos del vehÃ­culo?",
        "Â¿Necesitas la ficha tÃ©cnica del camiÃ³n?",
        "El camiÃ³n tiene GPS, control de temperatura y humedad.",
        "Â¿Deseas verificar el estado mecÃ¡nico del vehÃ­culo?",
        "Â¿Quieres que te envÃ­e el certificado de inspecciÃ³n?",
        "Â¿Necesitas saber el consumo de combustible?",
        "Â¿Quieres que active el modo eco del camiÃ³n?",
        "Â¿Deseas revisar el historial de mantenimiento?",
        "Â¿Quieres que te envÃ­e la patente y modelo?"
      ],
      insurance: [
        "El envÃ­o tiene seguro activo contra daÃ±os, robo y accidentes.",
        "Â¿Quieres ver los tÃ©rminos del seguro?",
        "Â¿Necesitas aumentar la cobertura?",
        "Â¿Deseas que te envÃ­e el certificado de pÃ³liza?",
        "Â¿Quieres activar el seguro contra demoras?",
        "Â¿Necesitas asistencia con una reclamaciÃ³n?",
        "Â¿Deseas que te explique las exclusiones?",
        "Â¿Quieres que te envÃ­e el nÃºmero de pÃ³liza?",
        "Â¿Necesitas que verifique la vigencia?",
        "Â¿Quieres que te contacte con el asegurador?"
      ],
      history: [
        "Â¿Quieres ver el historial de envÃ­os de este mes?",
        "Â¿Necesitas el reporte de entregas anteriores?",
        "Â¿Deseas comparar tiempos de entrega?",
        "Â¿Quieres que te muestre el rendimiento del transportista?",
        "Â¿Necesitas el historial de incidencias?",
        "Â¿Quieres que te genere un anÃ¡lisis de costos?",
        "Â¿Deseas ver las rutas mÃ¡s utilizadas?",
        "Â¿Quieres que te muestre el historial de productos?",
        "Â¿Necesitas el resumen anual?",
        "Â¿Quieres que te envÃ­e estadÃ­sticas de puntualidad?"
      ],
      settings: [
        "Â¿Quieres personalizar tus notificaciones?",
        "Â¿Deseas cambiar tu mÃ©todo de contacto preferido?",
        "Â¿Necesitas ajustar tus preferencias de envÃ­o?",
        "Â¿Quieres activar el modo nocturno permanentemente?",
        "Â¿Deseas guardar esta configuraciÃ³n como predeterminada?",
        "Â¿Quieres que te recuerde los envÃ­os programados?",
        "Â¿Necesitas configurar alertas personalizadas?",
        "Â¿Quieres que te envÃ­e resÃºmenes diarios?",
        "Â¿Deseas integrar con tu sistema ERP?",
        "Â¿Quieres que te configure accesos rÃ¡pidos?"
      ]
    };

    const savedTheme = localStorage.getItem('theme');
    if (savedTheme === 'dark') {
      document.documentElement.classList.add('dark');
    }

    const chatMessages = document.getElementById('chat-messages');
    const messageInput = document.getElementById('message-input');
    const sendButton = document.getElementById('send-button');

    function addMessage(text, isUser = true, sender = isUser ? "Carlos GÃ³mez" : "AgroLink IA", avatar = null) {
      const messageDiv = document.createElement('div');
      messageDiv.className = `flex items-start gap-3 max-w-lg ${isUser ? 'ml-auto justify-end flex-row-reverse' : ''}`;

      const avatarEl = document.createElement('div');
      if (avatar) {
        avatarEl.innerHTML = `<img alt="${sender} avatar" class="w-10 h-10 rounded-full" src="${avatar}" />`;
      } else {
        avatarEl.className = "w-10 h-10 rounded-full bg-primary flex items-center justify-center text-white font-bold";
        avatarEl.textContent = "ğŸ¤–";
      }

      const contentDiv = document.createElement('div');
      if (!isUser) {
        const senderName = document.createElement('p');
        senderName.className = "text-sm font-semibold text-text-secondary-light dark:text-text-secondary-dark mb-1";
        senderName.textContent = sender;
        contentDiv.appendChild(senderName);
      }

      const bubble = document.createElement('div');
      bubble.className = `p-3 rounded-lg message-bubble ${
        isUser
          ? 'bg-primary text-white dark:text-background-dark rounded-tr-none'
          : 'bg-surface-light dark:bg-surface-dark rounded-tl-none'
      }`;
      bubble.textContent = text;

      contentDiv.appendChild(bubble);
      messageDiv.appendChild(avatarEl);
      if (!isUser) {
        messageDiv.appendChild(contentDiv);
      } else {
        messageDiv.insertBefore(contentDiv, avatarEl);
      }

      chatMessages.appendChild(messageDiv);
      chatMessages.scrollTop = chatMessages.scrollHeight;
    }

    function getAIResponse(userMessage) {
      const msg = userMessage.toLowerCase().trim();

      if (msg.includes('hola') || msg.includes('buenos') || msg.includes('hi') || msg.includes('saludos')) {
        return getRandomResponse(responsesDB.greeting);
      } else if (msg.includes('gracias') || msg.includes('thank') || msg.includes('genial') || msg.includes('bueno')) {
        return getRandomResponse(responsesDB.thanks);
      } else if (msg.includes('llegaste') || msg.includes('llegar') || msg.includes('cuÃ¡ndo') || msg.includes('donde') || msg.includes('llego')) {
        return getRandomResponse(responsesDB.arrival);
      } else if (msg.includes('maÃ­z') || msg.includes('producto') || msg.includes('cantidad') || msg.includes('toneladas') || msg.includes('calidad')) {
        return getRandomResponse(responsesDB.product);
      } else if (msg.includes('retraso') || msg.includes('atraso') || msg.includes('demora') || msg.includes('tarde') || msg.includes('retrasar')) {
        return getRandomResponse(responsesDB.delay);
      } else if (msg.includes('llegÃ³') || msg.includes('llegue') || msg.includes('finalizado') || msg.includes('entregado') || msg.includes('completado')) {
        return getRandomResponse(responsesDB.arrived);
      } else if (msg.includes('ayuda') || msg.includes('necesito') || msg.includes('puedes') || msg.includes('asistencia') || msg.includes('soporte')) {
        return getRandomResponse(responsesDB.help);
      } else if (msg.includes('ubicaciÃ³n') || msg.includes('donde') || msg.includes('localizaciÃ³n') || msg.includes('gps') || msg.includes('posiciÃ³n')) {
        return getRandomResponse(responsesDB.location);
      } else if (msg.includes('documento') || msg.includes('factura') || msg.includes('guÃ­a') || msg.includes('remito') || msg.includes('certificado')) {
        return getRandomResponse(responsesDB.documentation);
      } else if (msg.includes('pago') || msg.includes('facturaciÃ³n') || msg.includes('cobro') || msg.includes('costo') || msg.includes('presupuesto')) {
        return getRandomResponse(responsesDB.payment);
      } else if (msg.includes('emergencia') || msg.includes('urgente') || msg.includes('problema') || msg.includes('accidente') || msg.includes('falla')) {
        return getRandomResponse(responsesDB.emergency);
      } else if (msg.includes('clima') || msg.includes('tiempo') || msg.includes('lluvia') || msg.includes('temperatura') || msg.includes('humedad')) {
        return getRandomResponse(responsesDB.weather);
      } else if (msg.includes('camiÃ³n') || msg.includes('vehÃ­culo') || msg.includes('patente') || msg.includes('modelo') || msg.includes('mercedes')) {
        return getRandomResponse(responsesDB.vehicle);
      } else if (msg.includes('seguro') || msg.includes('pÃ³liza') || msg.includes('cobertura') || msg.includes('asegurado') || msg.includes('riesgo')) {
        return getRandomResponse(responsesDB.insurance);
      } else if (msg.includes('historial') || msg.includes('anterior') || msg.includes('pasado') || msg.includes('reporte') || msg.includes('estadÃ­sticas')) {
        return getRandomResponse(responsesDB.history);
      } else if (msg.includes('configuraciÃ³n') || msg.includes('ajustes') || msg.includes('preferencias') || msg.includes('notificaciones') || msg.includes('modo')) {
        return getRandomResponse(responsesDB.settings);
      } else {
        return getRandomResponse(responsesDB.default);
      }
    }

    function getRandomResponse(array) {
      return array[Math.floor(Math.random() * array.length)];
    }

    function sendMessage() {
      const text = messageInput.value.trim();
      if (!text) return;

      addMessage(text, true, "Carlos GÃ³mez", "https://lh3.googleusercontent.com/aida-public/AB6AXuAm8DIfc2-aVnp6ferONRrqZFFnJVdspxaaxdoB115ltIKjLKZAGGhImEGoLp1SjhZR40O6RvJfY4SmMv6cYM4SnM6Wrc5jiDR9_rm3RFA_XlqkXrWpn8zP6YjHIBSJTKxvYbIel3hZNlxKB05X_Xxov9qoZQ1nVzOg55ZFsRlduzUBLa8Uf3khUSOGZbIDe0kPt9EoE9e2xDPXXAuuQJOBKbN0gZx7HQx-GU50lXpLZWC3X8Tzlami-J5yBA06Rlfl8SOnJpwzpw");

      messageInput.value = '';

      setTimeout(() => {
        const aiResponse = getAIResponse(text);
        addMessage(aiResponse, false);
      }, 800);
    }

    sendButton.addEventListener('click', sendMessage);
    messageInput.addEventListener('keypress', (e) => {
      if (e.key === 'Enter') sendMessage();
    });

    addMessage(getRandomResponse(responsesDB.greeting), false);
  </script>
</body>
</html>